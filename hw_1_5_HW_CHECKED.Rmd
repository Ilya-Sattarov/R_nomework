---
title: "hw_1_5"
output: html_document
---

1. Придумайте и реализуйте S3-класс для хранения типичной информации, наносимой на визитку (имя, фамилия, контакты - почта/телефон и другие, на свой выбор).

```{r}
# s3
#name_card <- structure("name_card", class = "name_card") # не требуется.

create_name_card <- function(title, first_name, surename, company, position, email, telephone, telephone2 = "") {
  return(structure(list(title = title,
                        first_name = first_name,
                        surename = surename,
                        company = company,
                        position = position,
                        email = email,
                        telephone = telephone,
                        telephone2 = telephone2),
                   class = "name_card"))
  }
  
card1 <- create_name_card("Mr", "John", "Dow", "SM Hospital", "Therapist", "JohnDow@hospitalsm.com", "43134123553", "431346523543")

card2 <- create_name_card("Mrs", "Anna", "Smith", "SM Hospital", "Nurse", "a.smith@hospitalsm.com", "435679832310")


# тестовые действия для проверки корректности объектов:

card2$telephone #отдельное значение

class(card1) #проверяется класс созданного объекта

typeof(card1) # базовый тип "list" класса "name_card" 



# Пример визитной карточки с использованием класса S4

setClass("name_card_S4",
          slots = list(title = "character",
                        first_name = "character",
                        surename = "character",
                        company = "character",
                        position = "character",
                        telephone = "character",
                        email = "character",
                        additional = "character"
                       )
         )
card1_S4 <- new("name_card_S4", 
             title = card1$title,
                               first_name = card1$first_name,
                               surename = card1$surename,
                               company = card1$company,
                               position = card1$position,
                               telephone = card1$telephone,
                               email = card1$email,
                               additional = "Doctor of Medicine"
             )

card1_S4@additional
class(card1_S4)

```

2. Напишите метод для красивого вывода содержимого объекта из первого задания в консоль. Метод можно назвать, к примеру, print. Под красивым выводом подразумевается, что каждый элемент будет выведен с соответствующей заметкой (например: к полю имя сделать вывод "ИМЯ: S3$name").

```{r}

print <- function(x) UseMethod("print") # обязателен ли данный код? Или без него можно обойтись? Все таки print-ов может быть много для разных классов, а данная команда не конкретизирует для какого класса применяется метод.

print.name_card <- function(x) {
  if (x$title == "") {
    
    if (x$telephone2 == "") {
      out <- paste0("This is business card.\n NAME: ", x$first_name, 
                    "\n SURENAME: ", x$surename, "\n PLACE OF WORK: ", x$company, 
                    "\n POSITION: ", x$position, " \n E-MAIL: ", x$email, " \n PHONE: ", x$telephone)
    } else {
      out <- paste0("This is business card.\n NAME: ", x$first_name, 
                    "\n SURENAME: ", x$surename, "\n PLACE OF WORK: ", x$company, 
                    "\n POSITION: ", x$position, " \n E-MAIL: ", x$email, " \n PHONE: ", x$telephone,
                    " \n PHONE 2: ", x$telephone2)    
    }
  } else {
    if (x$telephone2 == "") {
      out <- paste0("This is business card.\n TITLE: ", x$title, "\n NAME: ", x$first_name, 
                    "\n SURENAME: ", x$surename, "\n PLACE OF WORK: ", x$company, 
                    "\n POSITION: ", x$position, " \n E-MAIL: ", x$email, " \n PHONE: ", x$telephone)
    } else {
      out <- paste0("This is business card.\n TITLE: ", x$title, "\n NAME: ", x$first_name, 
                    "\n SURENAME: ", x$surename, "\n PLACE OF WORK: ", x$company, 
                    "\n POSITION: ", x$position, " \n E-MAIL: ", x$email, " \n PHONE: ", x$telephone,
                    " \n PHONE 2: ", x$telephone2)    
    }
  }  
  cat(out)
  return(invisible(x))
}

card1$telephone2
card1$title = ""
print (card1)
print (card2)

```


3. Найдите все методы, доступные для функции `summary()` и для класса `matrix`.

```{r}
methods(generic.function = "summary") # все методы, доступные для функции summary() 

methods(class="matrix") # все методы, доступные для класса matrix 

```


4. Задача со звездочкой. Напишите функцию, выполняющую транслитерацию произвольного текста.

```{r}
#Вариант 1
translit <- function(text) {
  
  # В lat_up только первые символы сделаны заглавными
  lat_up <- c("A","B","V","G","D","E","Yo","Zh","Z","I","J","K",
              "L","M","N","O","P","R","S","T","U","F","Kh","C","Ch",
              "Sh","Shh","''","Y","'","E'","Yu","Ya")
  rus_up <- c("А","Б","В","Г","Д","Е","Ё","Ж","З","И","Й","К","Л","М","Н",
              "О","П","Р","С","Т","У","Ф","Х","Ц","Ч","Ш","Щ","Ъ","Ы","Ь",
              "Э","Ю","Я")
  lat_low <- c("a","b","v","g","d","e","yo","zh","z","i","j","k","l","m","n",
               "o","p","r","s","t","u","f","kh","c","ch","sh","shh","''","y",
               "'","e'","yu","ya")
  rus_low <- c("а","б","в","г","д","е","ё","ж","з","и","й","к","л","м","н","о",
               "п","р","с","т","у","ф","х","ц","ч","ш","щ","ъ","ы","ь",
               "э","ю","я")
  # основной код
  
  n <- nchar (text)                 #длина строки
  vec2 <- vector(length = n, mode = "character")  #вспомогательный вектор, в который будут записываться значения
  
  for (i in 1:n) {                        #цикл проверки каждого символа
    ch_rus <- substr(text, i, i)                  # извлекаем символ
    if (ch_rus %in% rus_low) {                    #если маленькая буква из кириллицы
      ch_lat <- lat_low[(rus_low == ch_rus)]
    } else if (ch_rus %in% rus_up) {              #если большая буква из кириллицы
      ch_lat <- lat_up[(rus_up == ch_rus)]
    } else {                                  #остальные символы без изменений
      ch_lat <- ch_rus
    }
    vec2[i] <- ch_lat
  }
  
  text_lat <- paste (vec2, collapse = "")         #преобразуем вектор в итоговую строку
  
  return(text_lat)

}

#Вариант 2. альтернативный код для преобразования текста.

translit2 <- function(text, lang) {
  
  # В lat_up только первые символы сделаны заглавными
  lat_up <- c("A","B","V","G","D","E","Yo","Zh","Z","I","J","K",
              "L","M","N","O","P","R","S","T","U","F","Kh","C","Ch",
              "Sh","Shh","''","Y","'","E'","Yu","Ya")
  rus_up <- c("А","Б","В","Г","Д","Е","Ё","Ж","З","И","Й","К","Л","М","Н",
              "О","П","Р","С","Т","У","Ф","Х","Ц","Ч","Ш","Щ","Ъ","Ы","Ь",
              "Э","Ю","Я")
  lat_low <- c("a","b","v","g","d","e","yo","zh","z","i","j","k","l","m","n",
               "o","p","r","s","t","u","f","kh","c","ch","sh","shh","''","y",
               "'","e'","yu","ya")
  rus_low <- c("а","б","в","г","д","е","ё","ж","з","и","й","к","л","м","н","о",
               "п","р","с","т","у","ф","х","ц","ч","ш","щ","ъ","ы","ь",
               "э","ю","я")
  
  
  
  
  # основной код

  
  if (lang == "rus")  {
    
    n <- length(rus_up)                 #количество букв в кириллице
    text_lat <- text
    for (i in 1:n) {                        #цикл проверки каждой буквы в кириллице
      text_lat <- gsub(rus_up[i], lat_up[i], text_lat)
      text_lat <- gsub(rus_low[i], lat_low[i], text_lat)
    }
    
    return(text_lat)
      
  } else if (lang == "eng") {
      
    m <- length(lat_up)                 #количество букв в латинице
    text_rus <- text
    for (i in 1:m) {                        #цикл проверки каждой буквы в латинице
      text_lat <- gsub(lat_up[i], rus_up[i], text_lat)
      text_lat <- gsub(lat_low[i], rus_low[i], text_lat)
    }
    
    return(text_lat)
      
  }

}


text<- "Вскоре было дано Шёнграбенское сражение. 4-хтысячная армия Багратиона должна была обеспечить отступление всей остальной армии Кутузова. Французы же решили, что перед ними вся русская армия."

translit (text) 
translit2 (text)

translit (text) == translit2 (text)  #результат одинаковый

```

___

# Комментарий к работе

Илья, спасибо за домашнее задание! Работа выполнена добротно, код полностью рабочий.

Напомню, что **целью данного домашнего задания является научиться писать объекты в R, в частности, объекты класса S3, а также методы для них. Это пригодится как в случае, если в будущем Вы будете заниматься разработкой в R, а также просто для понимания того, как в R работают объекты. Учитывая, что R, как правило, используется сугубо для аналитики, то тема довольно специфическая, но на базовом уровне её освоить тоже неплохо.** 

**Задача 1:** У Вас получилось реализовать класс типа S3. Полей достаточно, они разнообразны. Есть конструктор. Проверялись типы функциями `class` и `typeof`. Также реализован класс S4, здорово, что у Вас получилось.

```{r}
library(pryr)
otype(card1)
otype(card1_S4)
```

Функции из пакета `pryr` я на занятии не затрагивал, но в код лекции их включил в конце. Они по большей части технические, существуют для создания органичений и просто для получения информации об объектах. 

Добавить особо нечего, всё сделано хорошо.

**Задача 2:** Да, действительно, `print <- function(x) UseMethod("print")` не является обязательным кодом, так как `print` априори существует как метод для многих (почти всех) объектов. 

Оформление вывода метода простое и минималистичное. Вывод делается через `cat()`, есть возврат самого объекта. Можно отметить повторы кода для создания переменной out. Как вариант, многочисленные `paste0()` можно было представить в виде функций (тут, кстати, можно удачно применить замыкание, которое мы прошли). Останется только передать в функцию аргументы.

**Задача 3:** Думаю, тут всё довольно просто, комментарии не нужны!

**Задача 4:** Хорошо, что Вы приступили к этой задаче! Цель задачки - научиться продумывать алогоритмы. В данном случае, нужно было реализировать функцию-траслит. 

```{r}
translit("Shhavel'")
translit("SHHavel")

translit("I dont speak english")

translit("Штрудель")
```

У реализованной функции в целом получается переводить с кариллицы на латиницу, но не наоборот. Очень рекомендую дополнить программу. Кроме того, чтобы учесть, что транслитерироваться иногда могут 3-2 символа на букву, имеет смысл начать проверку с этих букв, то есть сначала перевести триплеты (к примеру, перевести сначала все "Щ" - "SHH", потом буквы на 2 символа и тд). Также код пока что не поддерживает векторизацию - это может быть очень полезным нововведением, в R многие функции это поддерживают.

В остальном реализация мне нравится, работа мне понравилась, всё сделано на отличном уровне. 

По оценкам - пройдусь по критериям:

Критерии оценивания: 

 * Домашнаяя работа сдана, работа содержит наработки решения (1/1 балл)
 * Решена 1 задача (2/2 балла)
 * Решена 2 задача (2/2 балла)
 * Решена 3 задача (1/1 балл)
 * Задание сдано до рекомендуемого дедлайна (2/2 балла) _явный дедлайн я не обозначал, но задание было выполнено до следующего занятия - поставлю полный балл._
 * Код оформлен согласно рекомендациям tidyverse (1/1 балл)
 * Задание сдано с 1 раза (нет необходимости в доработках) (1/1 балл)
 
Дополнительные баллы:
 * В 1 задаче помимо объекта класса S3 реализиван класс другого типа (S4, R6, RC) - (макс 2/2 балла)
 * Решена 4 задача (2/3 балла) - 1 балл снимаю за то, что не транслита из латиницы в кириллицу и векторизации.
 
Задание считается выполненным, если набирается 7 баллов
 
**ИТОГО: `r 1+2+2+1+2+1+1+2+2` баллов**, домашняя работа принята! Над дополнениями рекомендую подумать самостоятельно, если будут вопросы - пишите. 

Успехов в дальнейшем обучении!
